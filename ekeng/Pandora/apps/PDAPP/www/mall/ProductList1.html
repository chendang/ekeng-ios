<!DOCTYPE html>
<html>

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
		<meta content="yes" name="apple-mobile-web-app-capable" />
		<meta content="black" name="apple-mobile-web-app-status-bar-style" />
		<meta content="telephone=no" name="format-detection" />
		<title>e康</title>
		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/lib/mui.min.css">
		<link rel="stylesheet" href="../css/lib/huimin.css" />
		<link rel="stylesheet" href="../css/head.css">
		<!--App自定义的css-->
		<link href="../css/MallIndex.css" rel="stylesheet">
		<link rel="stylesheet" type="text/css" href="../css/ProductList.css">
		<script src="../js/base.js"></script>
		<script src="../js/lib/jquery-2.1.3.min.js"></script>
		<script src="../js/ProductList.js"></script>

		<style>
			[v-cloak] {
				display: none;
			}
			
			html,
			body,
			.mui-content {
				max-width: 100%;
				margin-top: 42px;
			}
			
			/*.mui-scroll-wrapper {
				height: 40px;
				width: auto;
				right: 10px;
			}*/
			
			ul {margin: 0; padding: 0;}
			
			.hot-pro-bot-box {
				margin-top: 40px;
			}
			
			.banner {
				margin-top: 40px;
			}
			
			.nav-out {
				position: fixed;
				top: 45px;
			}
			
			.nav-con {
				top: 90px;
				bottom: 53px;
			}
			
			#app {
				
				top: 0px;
				bottom: 0px;
				width: 100%;
			}
			
			#wrapper {
                position: absolute;
				top: 80px;
				/*bottom: 2px;*/
				width: 100%;
				height: 450px;
			}
			
			/*#scroller {
				margin: 0;
				padding: 0;
				
			}*/
			
			.icash-back-item {
				height: 320px;
				line-height: 60px;
				border-bottom: 1px solid #ddd;
				text-indent: 1em;
				background: #fff;
			}
			
			.jroll-infinite-tip {
				height: 44px;
				line-height: 44px;
				text-align: center;
			}
			
			.jroll-vue-infinite {
				height: 100%;
			}
		</style>
	</head>

	<body>

		<script>
			HeadRed("产品列表");
		</script>

		<div class="mui-content" id="app">

			<!--导航-->
			<!--<div class="nav-out">
				<div class="hot-pro-nav">
					<div class="mui-scroll-wrapper">
						<ul class="mui-scroll clearfix">
							<li>
								<a class="active" href="javascript:void(0)">全部</a>
							</li>
							<li v-for="(Item,index) in ClassList" v-cloak>
								<a href="javascript:void(0)">{{Item.ClassName}}</a>
							</li>

						</ul>
					</div>
				</div>
			</div>-->
			<!--导航-->


			<!--折叠展开列表内容-->
			<!--Banner-->
			<!--<div id="slider" class="mui-slider">
				<div class="mui-slider-group mui-slider-loop">
					
					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../img/1-01.jpg">
						</a>
					</div>
				
					<div class="mui-slider-item">
						<a href="#">
							<img src="../img/11-01.jpg">
						</a>
					</div>
				
					<div class="mui-slider-item">
						<a href="#">
							<img src="../img/11.jpg">
						</a>
					</div>


					<div class="mui-slider-item mui-slider-item-duplicate">
						<a href="#">
							<img src="../img/10.jpg">
						</a>
					</div>
				</div>
				<div class="mui-slider-indicator">
					<div class="mui-indicator mui-active"></div>
					<div class="mui-indicator"></div>

				</div>
			</div>-->

			<!--banner-end-->
			<!--排序-->
			<div class="sort-list" style="margin-top: -44px;">
				<ul class="goods-all-tit-list clearfix">
					<li>
						<a class="on" href="javascript:void(0)">最新上线</a>
					</li>
					<li>
						<a href="javascript:void(0)">销量优先</a>
					</li>
					<li>
						<a href="javascript:void(0)">价格排序</a>
						<div class="up-down-icon"><span class="sort-up active"></span><span class="sort-down"></span></div>
					</li>
				</ul>
			</div>
			<!--排序-->
			<!--活动列表-->
			<div id="wrapper">
			<jroll-infinite class="jroll-vue-infinite">
			<div class="cash-back-group">
			
			
			<ul class="mui-table-view mui-grid-view">
			<li class="mui-table-view-cell mui-media mui-col-xs-6" v-for="(Item,index) in ItemList" v-cloak style="height: 153px;">
				<a v-on:click="goProductDetail(Item.ProductId)">
					<img class="mui-media-object" :src="Item.img_url" height="88px">
					<div class="mui-media-body">{{Item.ProductTitle}}</div>
					<div class="goods_info"> <span class="price_info">￥{{Item.sell_price}}</span> <!--<span class="fav_num">2889人购买</span> --></div>
				</a>
			</li>
			
		    </ul>
			


			</div>
			</jroll-infinite>
			</div>
			<!--活动列表-->
<!--<div style="height:20px;"></div>--> 
		</div>
 
		<!--container-end-->
		<script src="../js/lib/mui.min.js"></script>
		<script src="../js/public.js" type="text/javascript"></script>
		<script src="../js/lib/hui.js" type="text/javascript"></script>

		<script src="../js/lib/vue20.min.js" type="text/javascript"></script>
		<script src="../js/lib/axios.min.js"></script>
		<script src="../js/lib/qs.js"></script>
		<script src="../js/lib/jroll.js" type="text/javascript"></script>
		<script src="../js/lib/jroll-vue-infinite.js" type="text/javascript"></script>
		<script src="../js/lib/jroll-pulldown.js" type="text/javascript"></script>

		<script>


			

			var classId = getUrlParam("ClassId"); 
			(function(w) {
				
				if(classId == undefined || classId == null) {
					hui.upToast("获取产品类别参数错误,请返回重新选择");
					setTimeout(function() {
						window.history.go(-1);
					}, 1000);

					return false;
				}
			})(window);
			
			var domainUrl = GetMallApiDomain();
			var ImageUrl=GetMallImage();

			var strWhere=" 1=1";
			var filedOrder='id';

			function muiPready() {

				mui.init({
					swipeBack: true, //启用右滑关闭功能
				});
				mui('.mui-scroll-wrapper').scroll({
					deceleration: 0.0005, //flick 减速系数，系数越大，滚动速度越慢，滚动距离越小，默认值0.0006
					scrollY: false, //是否竖向滚动
					scrollX: true, //是否横向滚动
					startX: 0, //初始化时滚动至x
					startY: 0, //初始化时滚动至y
					bounce: true, //是否启用回弹
					bounceTime: 500, //回弹动画时间
					scrollTime: 500,
					directionLockThreshold: 5,
					indicators: false
				});

			}


			// vue实例
			var vum
			var infOptions = {
				pulldown: {},
				bottomed: function(complete) {
					var that = this;
					axios.get(domainUrl + 'api/Product/getProductList', {
							params: {
								category_id: classId,
								pageIndex: that.page+1,
								strWhere: strWhere,
								filedOrder: filedOrder
							}
						})
						.then(function(response) {
							var jsonx = eval(response.data.RecordList);
							that.$parent.ItemData = [];
							each(jsonx, function(i, j) {

								that.$parent.ItemData.push({
									number: (i + 1),
									bid: j.bid,
									ProductId: j.ProductId,
									ProductTitle: cutstr(j.ProductTitle, 30),
									ProductRemark: cutstr(j.ProductRemark, 30),
									img_url: ImageUrl+j.img_url,
									sell_price: j.sell_price,
									point: j.point,
								});

							});

							if(typeof complete === 'function') {
								that.$parent.ItemList = that.$parent.ItemData;
								complete();
							} else {
								that.$parent.ItemList = that.$parent.ItemList.concat(that.$parent.ItemData);
							}

							that.$parent.pageCount = response.data.PageCount;
							if (response.data.PageCount==0){
								that.total =1;
							}
							else{
								that.total = response.data.PageCount;
							}
							

							that.success();
							
							that.scrollRefresh();

						})
						.catch(function(response) {
							console.log(response);
							that.error();
						});
				},
				updated: function() {
					console.log('current page is ' + this.page)
				}

			}

			vum = new Vue({
				el: '#app',
				components: {
					'jroll-infinite': JRoll.VueInfinite(infOptions, {
						scrollBarY: true
					})
				},
				data: {
					ItemData: [],
					ItemList: [],
					ClassList: []
				},
				mounted: function() {

					this.$nextTick(function() {
						muiPready();

						this.GetClassList(0, 2);

					})

				},
				methods: {


					GetClassList: function(parent_id, channel_id) {
						var that = this;
						that.axiosGetLoadding();
						axios.get(domainUrl + 'api/Product/getProductClassAndChild', {
								params: {
									p_id: parent_id,
									c_id: channel_id,
								}
							})
							.then(function(response) {
								var jsonx = eval(response.data.RecordList);
								that.ClassList = [];
								each(jsonx, function(i, j) {

									that.ClassList.push({
										number: (i + 1),
										ClassId: j.ClassId,
										ClassName: j.ClassName,
										img_url: ImageUrl+j.img_url
									});

								});

							})
							.catch(function(response) {
								console.log(response);

							});
					},
					axiosGetLoadding: function() {
						axios.interceptors.request.use(function(config) {
							console.log('开始请求')
							config.headers['Content-Type'] = 'application/x-www-form-urlencoded';
							hui.loading('数据加载中');
							return config
						}, function(error) {
							console.log('请求失败')
							hui.closeLoading();
							hui.toast("数据加载失败,请检查网络");
							return Promise.reject(error)
						})
						axios.interceptors.response.use(function(config) {
							hui.closeLoading();

							console.log('接收响应')
							return config
						}, function(error) {
							console.log('响应出错')
							hui.closeLoading();
							hui.toast("数据加载失败,请检查网络");
							return Promise.reject(error)
						})
					},
					
					goProductDetail: function(ProductId) {

						location.href = "ProductDetail.html?ProductId=" + ProductId;
					},
					

				}

			})
		</script>

		</script>
	</body>

</html>