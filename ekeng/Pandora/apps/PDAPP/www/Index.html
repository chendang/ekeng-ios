<!doctype html>
<html>

	<head>
		<title>e康云健康管理</title>
		<meta charset="utf-8">
		<meta name="format-detection" content="telephone=no" />
		<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no" />

		
		<script>
			
			
		</script>
		<link href="css/lib/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" type="text/css" href="css/lib/huimin.css">
		<link rel="stylesheet" type="text/css" href="css/lib/CSSRESET.css">
		<link rel="stylesheet" type="text/css" href="css/common.css">
		<link rel="stylesheet" type="text/css" href="css/index.css">

		<style type="text/css">
			[v-cloak] {
				display: none;
			}
			
			.circle {
				display: block;
				float: left;
				padding: 1px;
				margin-left: 2px;
				width: 15%;
			}
			
			.circles-text {
				margin-top: -6px;
			}
			
			a:link {
				text-decoration: none;
				color: #8295B3;
			}
			
			a:visited {
				text-decoration: none;
			}
			
			a:hover {
				text-decoration: none;
			}
			
			a:active {
				text-decoration: none;
			}
			
						.list_3{ margin:0.8rem 0; padding:0.5rem 0.3rem; font-size: 0; background: #fff; }
			.list_3 li{ /*width:33.3333%;*/width:50%; display: inline-block; padding:0.3rem;  position: relative; box-sizing: border-box; }
			.list_3 a{ display: block; }
			.list_3 img{  width:100%; border-radius: 0.5rem;}
			.list_3 div{ width:100%; height: 100%; position: absolute; top:0; left:0; padding:1.0rem; box-sizing: border-box; }
			.list_3 h5{ font-size: 1.4rem; color:#222; font-weight: bold; margin-bottom: 0.4rem; }
			.list_3 h6{ font-size: 1.1rem; color:#777; }
			.list_3 p{ font-size: 1.1rem; position: absolute; bottom:1rem; }
			.list_3 em{ font-size: 1.6rem; padding-right:0.6rem; color:inherit; }
			.list_3 strong{ font-size: 1.8rem; padding-right:0.6rem; color:inherit; }
			
			
		</style>
	</head>

	<body>
		<div class="_container" id="bodyinfo">

			<article class="wrapper" v-cloak>
				<div class="main">

					<div class="banner">

						<div class="fix">

						</div>
						<!-- nav -->

						<div class="swiper-wrapper" @click="goMainBannerUrl">
							<div class="swiper-slide" v-for="(Item,index) in Ad1List" v-cloak>
								<img :src="Item.Ad1_img_url" alt="" />
							</div>
						</div>
						<div class="pagination"></div>
					</div>
					<!-- msg -->


					<!-- title -->

					<div class="welcome">e康云健康管理系统</div>

					<div class="gray">
						<div class="funcs">
							<ul class="ul_links clearfix">
							<li>
								<a href="javascript:clicked('member/MemberDataIndex.html', 'MemberDataIndex.html', 'slide-in-left', '健康数据');">
									<span><img src="img/index_func_1.png" alt=""></span>
									<p>健康数据</p>
								</a>
							</li>

							<li>
								<a href="javascript:clicked('member/UploadCaseFiles.html', 'UploadCaseFiles.html', 'slide-in-left', '病历上传');">
									<span><img src="img/index_func_2.png" alt=""></span>
									<p>资料保存</p>
								</a>
							</li>


                            <li>
								<a href="javascript:clicked('member/TestMenu.html','TestMenu.html','zoom-fade-out','健康评测');">
									<span><img src="img/index_link_6.png" alt=""></span>
									<p>趣味自测</p>
								</a>
							</li>
							<li>
								<a @click="PowerCardActive(4);">
									<span><img src="img/index_func_6.png" alt=""></span>
									<p>健康评估</p>
								</a>
							</li>
							
							<li>
                            <a href="javascript:clicked('member/MyProjectRecord.html','TestMenu.html','zoom-fade-out','健康方案');">
                                <span><img src="img/index_func_7.png" alt=""></span>
                                <p>健康方案</p>
                            </a>
                        </li>
							
							<li>
								<a @click="GoImChat">
									<span><img src="img/doservices.png" alt=""></span>
									<p>在线客服</p>
								</a>
							</li>
							
							<li>
								<a href="javascript:clicked('member/AskedQuestionRecord.html','AskedQuestionRecord.html','zoom-fade-out','百问百答');">
									<span><img src="img/index_link_5.png" alt=""></span>
									<p>百问百答</p>
								</a>
							</li>
							
							<li>
								<a href="javascript:clicked('member/CaseShareRecord.html','CaseShareRecord.html','zoom-fade-out','案例分享');">
									<span><img src="img/index_link_7.png" alt=""></span>
									<p>案例分享</p>
								</a>
							</li>
							<!--<li>
								<a href="javascript:clickedNoHead('member/DeviceList.html', 'DeviceList.html', 'slide-in-left');">
										<span><img src="img/_index_menu_8.png" alt=""></span>
										<p>健康监测</p>
									</a>
							</li>-->

							

						</ul>
						</div>
						<!-- funcs -->

						<div class="news">
							<h2 class="cm_h2">
                            <span>健康资讯</span>
                            <a href="javascript:clicked('member/NewsIndex.html','NewsIndex.html','slide-in-right','健康资讯');">更多</a>
                        </h2>

							<ul class="ul_news" v-cloak>
								<li v-for="(Item,index) in NewsList" @click="ShowNewsContent(Item.NewsId)">
									<div><img :src="Item.NewsPic" alt="" /></div>
									<div>
										<h4 v-cloak>{{Item.NewsTitle}}</h4>
										<p>
											<a href="javascript:;" v-cloak>{{Item.LikeCount}}赞同</a>·
											<a href="javascript:;" v-cloak>{{Item.CommentCount}}评论</a>·
											<a href="javascript:;">关注问题</a>
										</p>
									</div>
								</li>

							</ul>
						</div>
						<!-- news -->
<div style="height: 50px;"></div>
					</div>
					<!-- chats -->
				</div>
				
			</article>
			
			<!-- wrapper End -->

		</div>
	</body>
	<script src="js/lib/mui.min.js"></script>
	
	<script src="js/lib/subViews.js"></script>
		<script src="js/lib/FooterNav.js"></script>
		<script src="js/index.js" type="text/javascript"></script>
	<script src="js/lib/jquery-2.1.3.min.js"></script>

	<script src="js/lib/vue20.min.js" type="text/javascript"></script>
	<script src="js/lib/hui.js" type="text/javascript"></script>
	<script src="js/public.js" type="text/javascript"></script>
	<script type="text/javascript">
		var domainUrl = GetMvcApiDomain();
		var mallDomainUrl = GetMallApiDomain();
		var menu, _self, _main;

		mui.init();






		function plusReadyDo() {

			mui.plusReady(function() {
				var launchFlag = plus.storage.getItem("launchFlag");
				if(!launchFlag){
					plus.webview.open('start.html', 'new', {}, 'none', 0);
					
                    setTimeout(function() {
					plus.navigator.closeSplashscreen();
					}, 200);
				}
				else{
					
				
                mui.os.ios&&plus.navigator.setFullscreen(true);  
				var objuser = JSON.parse(plus.storage.getItem('user'));

				if(objuser == undefined || objuser == null || objuser == '') {
					
					plus.webview.open('login.html', 'new', {}, 'none', 0);
					
                    setTimeout(function() {
					plus.navigator.closeSplashscreen();
					}, 200);
				} else {

					vum.UserName = objuser.UserName;
					vum.NickName=objuser.NickName;
					vum.HeadPic=objuser.HeadPic;
					
					
					var self = plus.webview.currentWebview();

                          var _footer = new plus.nativeObj.View('footer',{bottom: '0px',width: '100%'});

                    var _a = ['img/_icon_home.png','img/_icon_msg.png','img/_icon_restore.png','img/_icon_self.png'];
                    var _b = ['img/_icon_home_at.png','img/_icon_msg_at.png','img/_icon_restore_at.png','img/_icon_self_at.png'];
                    var _c = ['首页','消息','问答','我的'];
                    _fbar.setTabInfo(_footer,_a,_b,_c);
                    self.append(_footer);
                    					// 创建子webview窗口 并初始化
					var aniShow = {};
					util.initSubpage(aniShow);

					var nview = plus.nativeObj.View.getViewById('footer'),
						activePage = plus.webview.currentWebview(),
						targetPage,
						subpages = util.options.subpages,
						pageW = window.innerWidth;

                    
                    
                    
                    _fbar.setCB(function(tab){
                     console.log('切换选夹>>'+tab);

                     	// 子页面切换
                     	if(tab > 0) { 
                     	targetPage = plus.webview.getWebviewById(subpages[tab - 1]);
                     	}
                     	else{
                     		targetPage = plus.webview.currentWebview();
                     	}
                     	
                     	if(targetPage == activePage) {
							return;
						}
                     	
                     	if(tab == 1) {


							targetPage.evalJS("getFamilyJionMeBox('" + objuser.UserName + "','10');");
						}
                     	if(tab == 2) {
							targetPage.evalJS('getTopicList(20)');
						}                     	
                     	if(tab == 3) {
							targetPage.evalJS('isPlusReady()');
						}      
						
						util.changeSubpage(targetPage, activePage, aniShow);
						//更新当前活跃的页面
						activePage = targetPage;
                          console.log('当前>>'+targetPage);
//                          console.log('当前>>'+urlId);
                            

                     
                     });
					//	dblBackQuit();				

		                    
					vum.getUserInfo();
					vum.getUserAccount(objuser.UserName);
					vum.getNewsRecommendList('15', '10');
                    plus.navigator.closeSplashscreen();
				}
			 }

			});

		}
		
		

		
		

		plusReadyDo();

		var vum = new Vue({
			el: '#bodyinfo',
			data: function() {
				return {
					UserName: "",
					NickName: "",
					HeadPic: "",
					CardPowerActive: 0,
					Quality: '',
					CityAQI: '',
					TopicList: [],
					NewsList: []
				}
			},
			created: function() {

			},
			mounted: function() {

				this.$nextTick(function() {

				})

			},

			methods: {
				getTopicList: function(topcount) {
					var that = this;
					$.ajax({
						url: domainUrl + "api/Topic/getTopicList",
						type: 'get',
						dataType: "json",
						data: {
							topcount: topcount
						},
						beforeSend: function() {
							hui.h5Loading(false, '加载中...', {
								round: 2,
								padding: '20px',
								textalign: 'right'
							});
						},
						success: function(data) {
							$.each(data, function(i, j) {

								that.TopicList.push({
									number: (i + 1),
									topicId: j.Id,
									PostUser: j.UserName,
									headpic: j.headpic,
									title: j.title,
									CommentCount: j.CommentCount,
									LikeCount: j.LikeCount,
									PostTime: getDateDiff(getDateTimeStamp(j.posttime))
								});
							});
						},
						error: function() {
							hui.h5Loading(true);
							plus.nativeUI.toast("网络错误，请稍后再试");
						},
						complete: function(data, textStatus) {
							hui.h5Loading(true);
						}
					})

				},
				PowerCardActive: function(goid) {
						if(this.CardPowerActive == 0) {

							hui.confirm('您没有权限,需要激活服务卡？', ['取消', '确定'], function() {
								clicked('../mall/MyPowerCardCount.html', 'MyPowerCardCount.html', 'slide-in-left', '健康服务卡');
							});

						} else {
							if(goid == 1) {
								clicked('member/MemberDataIndex.html', 'MemberDataIndex.html', 'slide-in-left', '健康数据');
							}
							if(goid == 2) {
								clicked('member/UploadCaseFiles.html', 'UploadCaseFiles.html', 'slide-in-left', '病历上传')
							}
							if(goid == 3) {
								clicked('member/DeviceList.html', 'DeviceList.html', 'slide-in-left', '监测设备绑定');
							}
							if(goid == 4) {
								clicked('member/MyReportIndex.html', 'MyReportIndex.html', 'zoom-fade-out', '健康评估报告');
							}
							if(goid == 5) {
								clicked('member/MyProjectRecord.html', 'MyProjectRecord.html', 'zoom-fade-out', '健康方案');
							}
						}
					},
				getUserInfo: function() {
					var objuser = JSON.parse(plus.storage.getItem('user'));
					this.UserName = objuser.UserName;
					this.NickName = objuser.NickName;
					this.HeadPic = objuser.HeadPic;

				},
				
				getUserAccount: function(UserName) {
					var that = this;
					$.ajax({
						url: mallDomainUrl + "api/Member/getUserAccount",
						type: 'get',
						dataType: "json",
						data: {
							UserName: UserName
						},
						beforeSend: function() {
							hui.loading('数据加载中');
						},
						success: function(data) {
							if(data.code == '200') {
//								that.UserPoint = data.points;
//								that.UserAmount = data.amount;
								that.CardPowerActive = data.cardPower;
								
							}
						},
						error: function() {
							hui.closeLoading();
							hui.toast("网络错误，请稍后再试");
						},
						complete: function(data, textStatus) {
							hui.closeLoading();
						}
					})

				},
				
				getNewsRecommendList: function(newsClass, topcount) {
					var that = this;
					$.ajax({
						url: domainUrl + "api/News/getNewsRecommendList",
						type: 'get',
						dataType: "json",
						data: {
							newsClass: newsClass,
							topcount: topcount
						},
						beforeSend: function() {
							hui.h5Loading(false, '加载中...', {
								round: 2,
								padding: '20px',
								textalign: 'right'
							});
						},
						success: function(data) {
							var summary = "";
							$.each(data, function(i, j) {
								summary = j.summary + '...';
								that.NewsList.push({
									number: (i + 1),
									NewsId: j.Id,
									NewsTitle: j.title,
									NewsContent: j.content,
									summary: summary,
									NewsPic: j.img_src,
									CommentCount: j.CommentCount,
									LikeCount: j.LikeCount,
									FollowCount: j.FollowCount,
									click_number: j.click_number
								});

							});
						},
						error: function() {
							hui.h5Loading(true);
							plus.nativeUI.toast("网络错误，请稍后再试");
						},
						complete: function(data, textStatus) {
							hui.h5Loading(true);
						}
					})

				},

				getIsLikeSet: function(topicId) {
					var res = 0;
					var that=this;
					$.ajax({
						url: domainUrl + "api/Topic/getTopicIsSetLike",
						type: 'get',
						dataType: "json",
						async: false,
						data: {
							UserName: that.UserName,
							TopicId: topicId
						},
						success: function(data) {
							if(data.code == "200") {
								if(data.isHave >= "1") {
									res = '1';
								}
							}
						},
						error: function() {
							plus.nativeUI.toast("读取数据错误，请稍后再试");
							return false;
						}
					})

					return res;

				},

				SetLikePost: function(topicId) {
					var res = this.getIsLikeSet(topicId);
					if(res == '0') {
						var that=this;
						$.ajax({
							url: domainUrl + "api/Topic/GetTopicSetLike",
							type: 'get',
							dataType: "json",
							data: {
								UserName: that.UserName,
								TopicId: topicId
							},
							success: function(data) {
								if(data.code == "200") {
									plus.nativeUI.toast("点赞");
								}
							},
							error: function() {
								plus.nativeUI.toast("网络错误，请稍后再试");
							}
						})
					} else {
						plus.nativeUI.toast("已点赞");
					}
				},

				getIsFollowSet: function(topicId) {
					var res = 0;
					var that=this;
					$.ajax({
						url: domainUrl + "api/Topic/getIsSetFollow",
						type: 'get',
						dataType: "json",
						async: false,
						data: {
							UserName: that.UserName,
							TopicId: topicId
						},
						success: function(data) {
							if(data.code == "200") {
								if(data.isHave >= "1") {
									res = '1';
								}
							}
						},
						error: function() {
							plus.nativeUI.toast("网络错误，请稍后再试");
						}
					})

					return res;

				},

				SetFollowPost: function(topicId) {
					var res = this.getIsFollowSet(topicId);
					if(res == '0') {
						var that=this;
						$.ajax({
							url: domainUrl + "api/Topic/GetTopicSetFollow",
							type: 'get',
							dataType: "json",
							data: {
								UserName: that.UserName,
								TopicId: topicId
							},
							success: function(data) {
								if(data.code == "200") {
									plus.nativeUI.toast("关注成功");
								}
							},
							error: function() {
								plus.nativeUI.toast("网络错误，请稍后再试");
							}
						})
					} else {
						plus.nativeUI.toast("已关注");
					}
				},


				ShowNewsContent: function(id) {
					var parm = {
						"NewsId": id
					}
					clickedParm('member/ArticleContent.html', 'ArticleContent.html', 'slide-in-right', parm, '资讯详情');
				},
				ShowTopicContent: function(id) {
					var parm = {
						"TopicId": id
					}
					clickedParm('member/TopicContent.html', 'TopicContent.html', 'zoom-fade-out', parm, '健康话题');
				}

			}

		});
	</script>

</html>
