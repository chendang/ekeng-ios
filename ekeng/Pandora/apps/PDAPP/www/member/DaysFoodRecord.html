<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >
<meta name="format-detection" content="telephone=no" />

<link type="text/css" href="../css/foodopeate.css" rel="stylesheet" />
<link rel="stylesheet" href="../css/lib/huimin.css">



    
<style>
img{
border:0;
display:inline;
}



    a,input{outline: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}
    #choose{display: none;}
    canvas{width: 100%;border: 1px solid #000000;}

    .touch{background-color: #ddd;}
    .img-list{margin: 0px 0px;}
    .img-list li{position: relative;display: inline-block;width: 60px;height: 60px;margin: 2px 2px 6px 2px;border: 0px solid rgb(100,149,198);background: #fff no-

     repeat center;background-size: cover;}
    .progress{position: absolute;width: 100%;height: 20px;line-height: 20px;bottom: 0;left: 0;background-color:rgba(100,149,198,.5);}
    .progress span{display: block;width: 0;height: 100%;background-color:rgb(100,149,198);text-align: center;color: #FFF;font-size: 13px;}
    .size{position: absolute;width: 100%;height: 15px;line-height: 15px;bottom: -18px;text-align: center;font-size: 13px;color: #666;}
    .tips{display: block;text-align:center;font-size: 13px;margin: 10px;color: #999;}
    .pic-list{margin: 10px;line-height: 18px;font-size: 13px;}
    .pic-list a{display: block;margin: 10px 0;}
    .pic-list a img{vertical-align: middle;max-width: 30px;max-height: 30px;margin: -4px 0 0 10px;}
</style>
    
<title>E康云</title>

</head>

<body>


<!--膳食评论start-->
<div class="dietary-review dietary-review01">
  <h1>《中国居民膳食指南》推荐平衡膳食比例</h1>
  <div>
    <img src="../img/9-01.png" alt="" />
    <b class="p_01">25%</b>
    <b class="p_02">25%</b>
    <b class="p_03">50%</b>
  </div>
  <div class="today">
    <p>今天<br/>膳食记录</p>
  </div>
</div>
<!--膳食评论end-->

<!--列表start-->
<div class="dietary-list" id="foodinfo">
  <ul class="d-title">
    <li class="m_cell_hd"><p class="wd90">膳食种类</p></li>
    <li class="m_cell_hd m_cell_primary"><p>推荐标准</p></li>
    <li class="m_cell_ft"><p>少<i>适量</i>多</p></li>
  </ul>
  <ul class="d-list">
    <li>
      <div class="m_cell_hd"><ul><img src="../img/11-01.jpg" alt="90/60" /></ul></div>
      <div class="m_cell_hd m_cell_primary">
        <p>盐/6g</p>
        <p>油/25-30g</p>
      </div>
      <div class="m_cell_ft" id="part1">
        <a href="#" id='a1' class="on"><input type="checkbox" value="1" /></a>
        <a href="#" id='a2'><input type="checkbox" value="2" /></a>
        <a href="#" id='a3'><input type="checkbox" value="3" /></a>
      </div>
    </li>
    <li>
      <div class="m_cell_hd"><ul><img src="../img/11-02.jpg" alt="90/60" /></ul></div>
      <div class="m_cell_hd m_cell_primary">
        <p>奶及奶制品/300g</p>
        <p>大豆坚果类/25-35g</p>
      </div>
      <div class="m_cell_ft">
        <a href="#" class="on" id='b1'><input type="checkbox" value="1" checked="checked"/></a>
        <a href="#" id='b2'><input type="checkbox" value="2"/></a>
        <a href="#" id='b3'><input type="checkbox" value="3"/></a>
      </div>
    </li>
    <li>
      <div class="m_cell_hd"><ul><img src="../img/11-03.jpg" alt="90/60" /></ul></div>
      <div class="m_cell_hd m_cell_primary">
        <p>畜禽肉/40-70g</p>
        <p>水产类/40-75g</p>
        <p>蛋   类/ 40-50g</p>
      </div>
      <div class="m_cell_ft">
        <a href="#" class="on" id='c1'><input type="checkbox" value="1" checked="checked"/></a>
        <a href="#" id='c2'><input type="checkbox" value="2" /></a>
        <a href="#" id='c3'><input type="checkbox" value="3"/></a>
      </div>
    </li>
    <li>
      <div class="m_cell_hd"><ul><img src="../img/11-04.jpg" alt="" /></ul></div>
      <div class="m_cell_hd m_cell_primary">
        <p>蔬菜类/300-500g</p>
        <p>水果类/200-350g</p>
      </div>
      <div class="m_cell_ft">
        <a href="#" class="on" id='d1'><input type="checkbox" value="1" checked="checked"/></a>
        <a href="#" id='d2'><input type="checkbox" value="2"/></a>
        <a href="#" id='d3'><input type="checkbox" value="3"/></a>
      </div>
    </li>
    <li>
      <div class="m_cell_hd"><ul><img src="../img/11-05.jpg" alt="" /></ul></div>
      <div class="m_cell_hd m_cell_primary">
        <p>谷薯类/250-400g</p>
        <p>全谷雷和杂豆/50-150g</p>
        <p>薯类/50-100g</p>
      </div>
      <div class="m_cell_ft">
        <a href="#" class="on" id='e1'><input type="checkbox" value="1" checked="checked"/></a>
        <a href="#" id='e2'><input type="checkbox" value="2"/></a>
        <a href="#" id='e3'><input type="checkbox" value="3"/></a>
      </div>
    </li>
    <li>
      <div class="m_cell_hd"><ul><img src="../img/11-06.jpg" alt="" /></ul></div>
      <div class="m_cell_hd m_cell_primary">
        <p>水/1500-1700ml</p>
      </div>
      <div class="m_cell_ft">
        <a href="#" class="on" id='f1'><input type="checkbox" value="1" checked="checked"/></a>
        <a href="#" id='f2'><input type="checkbox" value="2"/></a>
        <a href="#" id='f3'><input type="checkbox" value="3"/></a>
      </div>
    </li>
  </ul>
  <ul class="today">
    <p>进餐总量</p>
  </ul>
  <ul class="clearfix total">
    <li>
      <a href="#" id='g1' class="on">
        <div><input type="checkbox" value="1"/></div>
        <h4>没吃饱 </h4>
      </a>
    </li>
    <li>
      <a href="#" id='g2'>
        <div><input type="checkbox" value="2"/></div>
        <h4>7成饱</h4>
      </a>
    </li>
    <li>
      <a href="#" id='g3'>
        <div><input type="checkbox" value="3"/></div>
        <h4>饱了</h4>
      </a>
    </li>
    <li>
      <a href="#" id='g4'>
        <div><input type="checkbox" value="4"/></div>
        <h4>很撑</h4>
      </a>
    </li>
  </ul>
  
  <ul class="d-button">
    <input type="button" value="提交" onclick="RecordSend();" id="RecordSave"/>
  </ul>
  
          <div class="comment">
            <textarea placeholder="记录你的美食日志" id="tContent"></textarea>
            <p>添加图片0/5</p>

			<div style="margin-left: 2px;">
			<ul class="img-list">

                <div id="photoFoodList">
                <img src="../img/icon_add_.png" alt="" height="60px" width="60px"  />	
                </div>
                <li>
				<img src="../img/icon_add_.png" alt="" height="60px" width="60px"  id="upload" />
				</li>

			</ul>
			<input type="file" id="choose" accept="image/*" multiple>
			
			
            </div>

        </div>
       
  <ul class="d-button">
    <input type="button" value="我要记录" onclick="TwitterSend();" id="TwitterSave"/>
  </ul>
</div>
<!--列表end-->

</body>

<script src="../js/base.js"></script>
<script src="../js/lib/jquery-2.1.3.min.js" type="text/javascript"></script>
<script src="../js/lib/hui.js"></script>
<script src="../js/public.js" type="text/javascript"></script>

<script src="../js/lib/axios.min.js"></script>
<script src="../js/lib/qs.js"></script>
<script src="../js/FoodUpload.js" type="text/javascript"></script>


<script>

var domainUrl = GetMvcApiDomain();
 
var username=null;  
function plusReady() { 
HeadShow();		
var objuser=JSON.parse(plus.storage.getItem('user'));
username = objuser.UserName;
getUploadListForPost(username, '1', '50')
back();
}

if(window.plus){  
plusReady();  
}else{  
document.addEventListener("plusready",plusReady,false);  
} 


var chkitem1 = '1';
var chkitem2 = '1';
var chkitem3 = '1';
var chkitem4 = '1';
var chkitem5 = '1';
var chkitem6 = '1';
var chkitem7 = '1';

$(".dietary-list .d-list li:nth-child(1) a").click(function(e) {

	e.preventDefault();
	if(!jQuery(this).hasClass("on")) {
		$(".dietary-list .d-list li:nth-child(1)  a.on").removeClass("on")
		$(".dietary-list .d-list li:nth-child(1)  a input").attr("checked", false);
	}
	$(this).addClass("on");
	$(this).find("input").attr("checked", true);

	var id = this.getAttribute('id');
	if(id == 'a1') {
		chkitem1 = '1';
	}
	if(id == 'a2') {
		chkitem1 = '2';
	}
	if(id == 'a3') {
		chkitem1 = '3';
	}

});
$(".dietary-list .d-list li:nth-child(2) a").click(function(e) {
	e.preventDefault();
	if(!jQuery(this).hasClass("on")) {
		$(".dietary-list .d-list li:nth-child(2)  a.on").removeClass("on")
		$(".dietary-list .d-list li:nth-child(2)  a input").attr("checked", false);
	}
	$(this).addClass("on");
	$(this).find("input").attr("checked", true);

	var id = this.getAttribute('id');
	if(id == 'b1') {
		chkitem2 = '1';
	}
	if(id == 'b2') {
		chkitem2 = '2';
	}
	if(id == 'b3') {
		chkitem2 = '3';
	}
});
$(".dietary-list .d-list li:nth-child(3) a").click(function(e) {
	e.preventDefault();
	if(!jQuery(this).hasClass("on")) {
		$(".dietary-list .d-list li:nth-child(3)  a.on").removeClass("on")
		$(".dietary-list .d-list li:nth-child(3)  a input").attr("checked", false);
	}
	$(this).addClass("on");
	$(this).find("input").attr("checked", true);

	var id = this.getAttribute('id');
	if(id == 'c1') {
		chkitem3 = '1';
	}
	if(id == 'c2') {
		chkitem3 = '2';
	}
	if(id == 'c3') {
		chkitem3 = '3';
	}

});

$(".dietary-list .d-list li:nth-child(4) a").click(function(e) {
	e.preventDefault();
	if(!jQuery(this).hasClass("on")) {
		$(".dietary-list .d-list li:nth-child(4)  a.on").removeClass("on")
		$(".dietary-list .d-list li:nth-child(4)  a input").attr("checked", false);
	}
	$(this).addClass("on");
	$(this).find("input").attr("checked", true);

	var id = this.getAttribute('id');
	if(id == 'd1') {
		chkitem4 = '1';
	}
	if(id == 'd2') {
		chkitem4 = '2';
	}
	if(id == 'd3') {
		chkitem4 = '3';
	}

});

$(".dietary-list .d-list li:nth-child(5) a").click(function(e) {
	e.preventDefault();
	if(!jQuery(this).hasClass("on")) {
		$(".dietary-list .d-list li:nth-child(5)  a.on").removeClass("on")
		$(".dietary-list .d-list li:nth-child(5)  a input").attr("checked", false);
	}
	$(this).addClass("on");
	$(this).find("input").attr("checked", true);

	var id = this.getAttribute('id');
	if(id == 'e1') {
		chkitem5 = '1';
	}
	if(id == 'e2') {
		chkitem5 = '2';
	}
	if(id == 'e3') {
		chkitem5 = '3';
	}

});
$(".dietary-list .d-list li:nth-child(6) a").click(function(e) {
	e.preventDefault();
	if(!jQuery(this).hasClass("on")) {
		$(".dietary-list .d-list li:nth-child(6)  a.on").removeClass("on")
		$(".dietary-list .d-list li:nth-child(6)  a input").attr("checked", false);
	}
	$(this).addClass("on");
	$(this).find("input").attr("checked", true);

	var id = this.getAttribute('id');
	if(id == 'f1') {
		chkitem6 = '1';
	}
	if(id == 'f2') {
		chkitem6 = '2';
	}
	if(id == 'f3') {
		chkitem6 = '3';
	}

});
$(".dietary-list .total li a").click(function(e) {
	e.preventDefault();
	if(!jQuery(this).hasClass("on")) {
		$(".dietary-list .total li a.on").removeClass("on")
		$(".dietary-list .total li a input").attr("checked", false);
	}
	$(this).addClass("on");
	$(this).find("input").attr("checked", true);

	var id = this.getAttribute('id');
	if(id == 'g1') {
		chkitem7 = '1';
	}
	if(id == 'g2') {
		chkitem7 = '2';
	}
	if(id == 'g3') {
		chkitem7 = '3';
	}
	if(id == 'g4') {
		chkitem7 = '4';
	}

});



function getUploadListForPost(UserName, sClass, topcount) {

	axiosGetLoadding();
	axios.get(domainUrl + 'api/Twitter/getUploadListForPost', {
			params: {
				UserName: UserName,
				sClass: sClass,
				topcount: topcount
			}
		})
		.then(function(response) {
			var recordlist = response.data;

			var inner = '';
			each(recordlist, function(i, arr) {
				inner += '<li>';
				inner += '<img src="' + domainUrl + 'api/upload/' + arr.FileName + '"  height="60px" width="60px" onclick="javascript:delFile(' + arr.id + ');">';
				inner += '</li>';
			});
			$("#photoFoodList").html(inner);

		})
		.catch(function(response) {
			console.log(response);
		});

}

function RecordSend() {

	TakeFoodSave(username, chkitem1, chkitem2, chkitem3, chkitem4, chkitem5, chkitem6, chkitem7);

}

function TwitterSend() {

	var tcontent = document.getElementById("tContent").value;

	if(tcontent == null || tcontent == "") {
		hui.toast("请说点什么哦！")
		return false;
	} else {
		getTwitterSave(username, '1',tcontent);
	}

}

function TakeFoodSave(UserName, typesPart1, typesPart2, typesPart3, typesPart4, typesPart5, typesPart6, typesPart7) {

	axiosRecordLoadding();
	axios.get(domainUrl + 'api/Food/getMDaysFoodTypesAdd', {
			params: {
				UserName: UserName,
				typesPart1: typesPart1,
				typesPart2: typesPart2,
				typesPart3: typesPart3,
				typesPart4: typesPart4,
				typesPart5: typesPart5,
				typesPart6: typesPart6,
				typesPart7: typesPart7
			}
		})

		.then(function(response) {
			if(response.data.code == '200') {
				if(response.data.res >= "1") {

					hui.toast("记录成功");

				} else {
					hui.toast("记录失败");
				}
			} else {
				hui.toast("记录失败!");
				return false;
			}

		})
		.catch(function(response) {
			console.log(response);
		});

}

function getTwitterSave(UserName, tClass,tcontent) {
	axiosTwitterLoadding();
	axios.get(domainUrl + 'api/Twitter/getTwitterSave', {
			params: {
				UserName: UserName,
				tClass: tClass,
				tContent: tcontent
			}
		})

		.then(function(response) {
			if(response.data.code == '200') {

				hui.iconToast('记录成功', 'success');
				window.setTimeout(function() {
					plus.webview.currentWebview().close();
				}, 500);

			} else {
				hui.toast("记录失败!");
				return false;
			}

		})
		.catch(function(response) {
			console.log(response);
		});

}

function delFile(Id) {

	hui.confirm('您确认删除此相片记录吗？', ['取消', '确定'], function() {

		axios.get(domainUrl + 'api/Twitter/getDelUploadRecordById', {
				params: {
					id: Id
				}
			})

			.then(function(response) {
				if(response.data.code == '200') {
					hui.toast("删除记录成功");
					getUploadListForPost(username, '1', '50');

				} else {
					hui.toast("删除记录失败!");
					return false;
				}

			})
			.catch(function(response) {
				console.log(response);
			});

	});

}

function axiosRecordLoadding() {
	axios.interceptors.request.use(function(config) {
		console.log('开始请求')
		config.headers['Content-Type'] = 'application/x-www-form-urlencoded';
		document.getElementById("RecordSave").value = "正在保存...";
		document.getElementById("RecordSave").disabled = true;
		return config
	}, function(error) {
		console.log('请求失败')
		document.getElementById("RecordSave").value = "保存失败";
		document.getElementById("RecordSave").disabled = false;
		return Promise.reject(error)
	})
	axios.interceptors.response.use(function(config) {

		document.getElementById("RecordSave").value = "成功保存";
		document.getElementById("RecordSave").disabled = false;
		console.log('接收响应')
		return config
	}, function(error) {
		console.log('响应出错')
		document.getElementById("RecordSave").value = "保存失败";
		document.getElementById("RecordSave").disabled = false;
		hui.toast("操作失败");
		return Promise.reject(error)
	})
}

function axiosTwitterLoadding() {
	axios.interceptors.request.use(function(config) {
		console.log('开始请求')
		config.headers['Content-Type'] = 'application/x-www-form-urlencoded';
		document.getElementById("TwitterSave").value = "正在记录...";
		document.getElementById("TwitterSave").disabled = true;
		return config
	}, function(error) {
		console.log('请求失败')
		document.getElementById("TwitterSave").value = "记录失败";
		document.getElementById("TwitterSave").disabled = false;
		return Promise.reject(error)
	})
	axios.interceptors.response.use(function(config) {

		document.getElementById("TwitterSave").value = "成功记录";
		document.getElementById("TwitterSave").disabled = false;
		console.log('接收响应')
		return config
	}, function(error) {
		console.log('响应出错')
		document.getElementById("TwitterSave").value = "记录失败";
		document.getElementById("TwitterSave").disabled = false;
		hui.toast("操作失败");
		return Promise.reject(error)
	})
}

function axiosGetLoadding() {
	axios.interceptors.request.use(function(config) {
		console.log('开始请求')
		config.headers['Content-Type'] = 'application/x-www-form-urlencoded';
		hui.loading('数据加载中');
		return config
	}, function(error) {
		console.log('请求失败')
		hui.closeLoading();
		hui.toast("数据加载失败,请检查网络");
		return Promise.reject(error)
	})
	axios.interceptors.response.use(function(config) {
		hui.closeLoading();

		console.log('接收响应')
		return config
	}, function(error) {
		console.log('响应出错')
		hui.closeLoading();
		hui.toast("数据加载失败,请检查网络");
		return Promise.reject(error)
	})
}

//    图片上传，将图片转成base64
function upload(basestr, type, $li) {
//	var text = window.atob(basestr.split(",")[1]);
	var pecent = 0,
		loop = null;

	$.ajax({
		type: "post",
		url: domainUrl + 'FileUpload/TwitterUpload',
		async: false,
		data: {
			base64File: basestr,
			UserName: username,
			sourceClass: 1
		},
		beforeSend: function() {

			mockProgress();

		},
		success: function(data) {

			clearInterval(loop);
			//当收到该消息时上传完毕
			$li.find(".progress span").animate({
				'width': "100%"
			}, pecent < 95 ? 200 : 0, function() {
				$(this).html("上传完成");
			});

		},

		error: function() {

		},
		complete: function(data, textStatus) {

		}

	});

	//数据用模拟进度
	function mockProgress() {
		if(loop) return;
		loop = setInterval(function() {
			pecent++;
			$li.find(".progress span").css('width', pecent + "%");
			if(pecent == 100) {
				clearInterval(loop);
			}
		}, 30)
	}

}


</script>

</html>
