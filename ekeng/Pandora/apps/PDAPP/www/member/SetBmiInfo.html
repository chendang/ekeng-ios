<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<!--标准mui.css-->
		<link rel="stylesheet" href="../css/lib/mui.min.css">
		<link href="../css/lib/mui.picker.css" rel="stylesheet" />
		<link href="../css/lib/mui.poppicker.css" rel="stylesheet" />

		<style>
			[v-cloak]{ display: none; }

		</style>
	</head>

	<body>


		<div class="mui-content" style="margin-top: 40px;">
			<div class="mui-content-padded">

				<!--<h5 class="mui-content-padded">请输入身高值</h5>-->
				<button id='showUserPicker' class="mui-btn mui-btn-block" type='button'>选择身高 ...</button>
				<div id='weightResult' class="ui-alert"></div>
				<!--<h5 class="mui-content-padded">请输入体重数值</h5>-->
				<button id='showWeightPicker' class="mui-btn mui-btn-block" type='button'>选择体重 ...</button>
				<div id='heightResult' class="ui-alert"></div>
               <button id='setbmival' type="button" class="mui-btn mui-btn-warning mui-btn-block">测算BMI值<span class="mui-badge mui-badge-warning" id="showBmiVal">未测算</span></button>
 
             <button id="btnBmiSave" type="button" class="mui-btn mui-btn-danger mui-btn-block" style="margin-top: 40px;">数据保存</button>
</div>
		</div>
		<script src="../js/lib/jquery-2.1.3.min.js" type="text/javascript"></script>
		<script src="../js/lib/mui.min.js"></script>
		<script src="../js/lib/mui.picker.js"></script>
		<script src="../js/lib/mui.poppicker.js"></script>
		<script src="../js/weight.data.js" type="text/javascript" charset="utf-8"></script>
		<script src="../js/public.js" type="text/javascript"></script>
		<script src="../js/base.js" type="text/javascript"></script>
<script>
		
		
var domainUrl = GetMvcApiDomain(); 


var username=null; 
function plusReady() { 
HeadShow();
var objuser=JSON.parse(plus.storage.getItem('user'));
username = objuser.UserName;

back();
}

if(window.plus){  
plusReady();  
}else{  
document.addEventListener("plusready",plusReady,false);  
} 	
		
(function($, doc) {
				$.init();
				$.ready(function() {
					//普通示例
					var userPicker = new $.PopPicker({
						layer: 1
					});
					userPicker.setData([{
						value: '200',
						text: '200CM'
					}, {
						value: '199',
						text: '199CM'
					},{
						value: '198',
						text: '198CM'
					},{
						value: '197',
						text: '197CM'
					},{
						value: '196',
						text: '196CM'
					},{
						value: '195',
						text: '195CM'
					},{
						value: '194',
						text: '194CM'
					},{
						value: '193',
						text: '193CM'
					},{
						value: '192',
						text: '192CM'
					},{
						value: '191',
						text: '191CM'
					},{
						value: '190',
						text: '190CM'
					},{
						value: '189',
						text: '189CM'
					}, {
						value: '188',
						text: '188CM'
					}, {
						value: '187',
						text: '187CM'
					}, {
						value: '186',
						text: '186CM'
					}, {
						value: '185',
						text: '185CM'
					}, {
						value: '184',
						text: '184CM'
					}, {
						value: '183',
						text: '183CM'
					}, {
						value: '182',
						text: '182CM'
					},{
						value: '181',
						text: '181CM'
					},{
						value: '180',
						text: '180CM'
					},{
						value: '179',
						text: '179CM'
					},{
						value: '178',
						text: '178CM'
					},{
						value: '177',
						text: '177CM'
					},{
						value: '176',
						text: '176CM'
					},{
						value: '175',
						text: '175CM'
					},{
						value: '174',
						text: '174CM'
					},{
						value: '173',
						text: '173CM'
					},{
						value: '172',
						text: '172CM'
					},{
						value: '171',
						text: '171CM'
					},{
						value: '170',
						text: '170CM'
					},{
						value: '169',
						text: '169CM'
					},{
						value: '168',
						text: '168CM'
					},{
						value: '167',
						text: '167CM'
					},{
						value: '166',
						text: '166CM'
					},{
						value: '165',
						text: '165CM'
					},{
						value: '164',
						text: '164CM'
					},{
						value: '163',
						text: '163CM'
					},{
						value: '162',
						text: '162CM'
					},{
						value: '161',
						text: '161CM'
					},{
						value: '160',
						text: '160CM'
					},{
						value: '159',
						text: '159CM'
					},{
						value: '158',
						text: '158CM'
					},{
						value: '157',
						text: '157CM'
					},{
						value: '156',
						text: '156CM'
					},{
						value: '155',
						text: '155CM'
					},{
						value: '154',
						text: '154CM'
					},{
						value: '153',
						text: '153CM'
					},{
						value: '152',
						text: '152CM'
					},{
						value: '151',
						text: '151CM'
					},{
						value: '150',
						text: '150CM'
					},{
						value: '149',
						text: '149CM'
					},{
						value: '148',
						text: '148CM'
					},{
						value: '147',
						text: '147CM'
					},{
						value: '146',
						text: '146CM'
					},{
						value: '145',
						text: '145CM'
					},{
						value: '144',
						text: '144CM'
					},{
						value: '143',
						text: '143CM'
					},{
						value: '142',
						text: '142CM'
					},{
						value: '141',
						text: '141CM'
					},{
						value: '140',
						text: '140CM'
					},{
						value: '139',
						text: '139CM'
					},{
						value: '138',
						text: '138CM'
					},{
						value: '137',
						text: '137CM'
					},{
						value: '136',
						text: '136CM'
					},{
						value: '135',
						text: '135CM'
					},{
						value: '134',
						text: '134CM'
					},{
						value: '133',
						text: '133CM'
					}, {
						value: '132CM', 
						text: '132CM'
					}]);
					var showUserPickerButton = doc.getElementById('showUserPicker');
					var showUserPicker = doc.getElementById('showUserPicker');
					var heightResult = document.getElementById("heightResult");
					showUserPickerButton.addEventListener('tap', function(event) {
						userPicker.show(function(items) {
							showUserPicker.innerText = items[0].text;
							heightResult.value=Number(items[0].value);
							//showUserPicker.innerText = JSON.stringify(items[0]);
							//返回 false 可以阻止选择框的关闭
							//return false;
						});
					}, false);
					//-----------------------------------------

					var weightPicker = new $.PopPicker({
						layer: 2
					});
					weightPicker.setData(weightData);
					var showWeightPickerButton = doc.getElementById('showWeightPicker');
					var weightResult = document.getElementById("weightResult");
					showWeightPickerButton.addEventListener('tap', function(event) {
						weightPicker.show(function(items) {
							showWeightPickerButton.innerText = items[0].text + " " + items[1].text;
							weightResult.value=Number(items[0].value) + Number(items[1].value);
							//返回 false 可以阻止选择框的关闭
							//return false;
						});
					}, false);
					//-----------------------------------------
					var bmival=0;
                    var val1=0;
                    var val2=0;
					setbmival.addEventListener('tap', function(event) {
						val1=heightResult.value;
                        val2=weightResult.value;
						bmival=(val2/Math.pow((val1/100),2)).toFixed(2);
						
						
						if (isNaN(bmival)){
						mui.toast('请选择身高与体重值！');	
						}
						else{
							document.getElementById("showBmiVal").innerHTML=bmival;

			            }
					}, false);
					
					
					btnBmiSave.addEventListener('tap', function(event) {
	                    
						if (isNaN(bmival) || bmival=='0'){
						mui.toast('请先测算BMI值再保存！');	
						}
						else{
                         setBmiSave(username,val1,val2,bmival);
			            }
						
					}, false);
					
					
					

	});
	

})(mui, document);
			
	
	
	function setBmiSave(username,iHeight,iWeight,iBmi){

             $.ajax({
             	url: domainUrl + "api/HItemRecord/getSetBmiSave",
                type: 'get',
                dataType: "json",
                data: {UserName:username,iHeight:iHeight,iWeight:iWeight,iBmi:iBmi},
                success: function (data) {
                	    if (data.code='200'){
                        mui.toast("您的数据成功提交！");
                        plus.webview.currentWebview().close();
                       
                      
                       }else{
                       	mui.toast("提交失败,请稍后再试！");
                       	return false;
                       }
                  },
                error: function () {
                mui.toast("网络错误，请稍后再试");
                 }
            })

  } 	
	



</script>
	</body>

</html>