<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title>个人中心</title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">

		<link rel="stylesheet" href="../css/lib/mui.min.css">
		<link rel="stylesheet" type="text/css" href="../css/lib/huimin.css">
		<link rel="stylesheet" type="text/css" href="../css/lib/CSSRESET.css">
		<link rel="stylesheet" type="text/css" href="../css/commonx.css">
		<link rel="stylesheet" type="text/css" href="../css/Personx.css">

		<script src="../js/lib/jquery-2.1.3.min.js"></script>
		<style>
			[v-cloak] {
				display: none;
			}
			
			.wrapper {

    bottom: 0.2rem;
    /* position: absolute; */

}
			
		</style>

	</head>

	<body>
		<div class="_container clear" id="bodyinfo">

			<div class="profile">
				<div onclick="clicked('PersonInfo.html', 'PersonInfo.html', 'slide-in-right', '我的资料');">
					<img :src='HeadPic' alt="" v-cloak/>
				</div>
				<div v-cloak>
					<h5 v-cloak>{{NickName}}&nbsp;&nbsp;<span v-if="UserPowerName!=''">{{UserPowerName}}</span></h5>
					<h6 v-cloak>{{UserName}}</h6>
					<p><span v-if="LevelName!=''" v-cloak>{{LevelName}}</span><span v-for="(Item,index) in RoleNameArr" v-cloak style="padding-left: 2px;margin-left: 2px;" @click="ExUserPower(Item.RolePower,Item.RoleName);">{{Item.RoleName}}</span></p>

					<!--<a href="javascript:;" class="a_s_setting"></a>-->
					<!--<a @click="GoImChat" class="a_s_msg"></a>-->
				</div>
			</div>
			<!-- profile -->
			<article class="wrapper">
				<div class="main">
					
					<!-- funcs -->

					<div class="sec order">
                    <h3>
                        <span>我的订单 <em>[重要安全提示]</em></span>
                        <i class="active" id="i_order"></i>
                    </h3>
                    
                    <div class="order_main">
                        <ul class="ul_order">
                            <li><a @click="goOrder('1');">待付款</a></li>
                            <li><a @click="goOrder('2');">待发货</a></li>
                            <li><a @click="goOrder('3');">待收货</a></li>
                            <li><a @click="goOrder('4');">评价</a></li>
                        </ul>
                    </div>
                </div>
					<!-- order -->

					<div class="sec wallet" id="wallet">
					<h3>
                        <span>我的钱包</span>
                        <i class="active" id="i_wallet"></i>
                    </h3>

						<div class="wallet_main">
							<ul class="ul_wallet">
								<li>
									<a href="javascript:;">
										<span v-cloak>{{UserAmount}}</span>
										<p>PV</p>
									</a>
								</li>

								<li>
									<a href="javascript:clicked('MyPointsRecord.html','MyPointsRecord.html','zoom-fade-out','我的积分纪录');">
										<span v-cloak>{{UserPoint}}</span>
										<p>积分</p>
									</a>
								</li>

								<li>
									<a href="javascript:;">
										<span class="violet" v-cloak>{{UserAmount}}</span>
										<p>PA币</p>
									</a>
								</li>

								<li>
									<a href="javascript:clicked('../mall/MyPowerCardCount.html','MyPowerCardCount.html','zoom-fade-out','我的卡包');">
										<span><img src="../img/icon_$.png" alt="" /></span>
										<p>卡包</p>
									</a>
								</li>
							</ul>
						</div>
					</div>
					<!-- ul_wallet -->

					<!--<div class="sec binding">
                    <a href="javascript:;">
                        <span>设备绑定<s>2</s></span>
                        <i></i>
                    </a>
                </div>-->
					<!-- binding -->

					<!--<div class="sec binding">
                    <a href="javascript:location.href='PersonMenuX.html?menux=1';" v-if="IsShowA==1">
                        <span style="background: url(../img/12_04.png) no-repeat left center /1.6rem auto;">客户管理</span>
                        <i></i>
                    </a>
                    <a href="javascript:location.href='PersonMenuX.html?menux=2';" v-if="IsShowB==1">
                        <span style="background: url(../img/s6.png) no-repeat left center /1.6rem auto;">合伙人管理</span>
                        <i></i>
                    </a>
                    <a href="javascript:location.href='PersonMenuX.html?menux=4';" v-if="IsShowC==1">
                        <span style="background: url(../img/13_05.png) no-repeat left center /1.6rem auto;">客户健康管理</span>
                        <i></i>
                    </a>
                    <a href="javascript:location.href='PersonMenuX.html?menux=3';" v-if="IsShowD==1">
                        <span style="background: url(../img/icon3.png) no-repeat left center /1.6rem auto;">店务管理</span>
                        <i></i>
                    </a>
                </div>-->

				<!--<div class="sec binding">
                   <a @click="PowerCardActive(3);">
                        <span style="background: url(../img/_index_menu_4.png) no-repeat left center /1.6rem auto;">设备绑定</span>
                        <i></i>
                    </a>
                    
                </div>-->
                
				<div class="sec binding">
                    
                    <a href="javascript:clicked('FavoriteArticleRecord.html','FavoriteArticleRecord.html','zoom-fade-out','我的收藏');">
                        <span style="background: url(../img/index_link_7.png) no-repeat left center /1.6rem auto;">我的收藏</span>
                        <i></i>
                    </a>
                    
                </div> 
                <div class="sec binding">
                    <a href="javascript:clicked('EditPerInfo.html','EditPerInfo.html','slide-in-left','基本资料修改');">	
                        <span style="background: url(../img/12_04.png) no-repeat left center /1.6rem auto;">个人资料</span>
                        <i></i>
                    </a>
                </div>
                <div class="sec binding">
                    <a href="javascript:clicked('EditPassword.html','EditPassword.html','slide-in-left','密码修改');">	
                        <span style="background: url(../img/7-06.jpg) no-repeat left center /1.6rem auto;">密码修改</span>
                        <i></i>
                    </a>
                </div>  
                <div class="sec binding">
                    <a href="javascript:clickedNoHead('../mall/AddressList.html','AddressList.html','slide-in-left');">	
                        <span style="background: url(../img/7-05.jpg) no-repeat left center /1.6rem auto;">收货地址</span>
                        <i></i>
                    </a>
                   
                </div>

                <!--<div class="sec binding">
                    <a href="javascript:clickedNoHead('../mall/PayTest.html','PayTest.html','slide-in-left');">	
                        <span style="background: url(../img/7-05.jpg) no-repeat left center /1.6rem auto;">支付测试</span>
                        <i></i>
                    </a>
                   
                </div>-->

					<div class="sec binding">
						<a @click="logout">
							<span style="background: url(../img/icon_clock.png) no-repeat left center /1.6rem auto;">退出登陆</span>
							<i></i>
						</a>

					</div>
					<!-- menus -->

					<!--<div class="sec menus">
                    <ul class="ul_menus">

                       
                        <li>
                            <h4>
                                <img src="../img/s5.png" alt="" />
                                <p>个人信息</p>
                            </h4>
                            
                            <div>
                                <p> <a href="javascript:location.href='EditPerInfo.html';">资料修改</a></p>
                                <p><a @click="telAuth();">手机认证</a></p>
                                <p><a href="javascript:location.href='Wx_Bind_GetCode.html';">绑定微信资料</a></p>
                            </div>
                        </li>
                        
                    </ul>
                </div>-->

				</div>
			</article>
			<!-- wrapper End -->

		</div>
	</body>
	<script src="../js/lib/mui.min.js"></script>
	<script src="../js/public.js" type="text/javascript"></script>
	<script src="../js/index.js"></script>
	<script src="../js/base.js" type="text/javascript"></script>
	<script src="../js/public.js" type="text/javascript"></script>
	<script src="../js/lib/hui.js" type="text/javascript"></script>
	<script src="../js/lib/vue20.min.js" type="text/javascript"></script>
	<script>
		var httpUrl = GetHttpApi();
		var domainUrl = GetMvcApiDomain();
		var mallDomainUrl = GetMallApiDomain();

		var UserName = '';
		var NickName = '';
		var HeadPic = '';
		var UserRole = '';
		var UserRoleName = '';
		var userbs = '';
		var PowerProperty = '';
		var telStats = '';

		var MasterName = '';
		var UserPower = '';
		var UserPowerName = '';

		function muiInit() {
			mui.init();
		}

		function plusReady() {

			var objuser = JSON.parse(plus.storage.getItem("user"));
			UserName = objuser.UserName;
			NickName = objuser.NickName;
			HeadPic = objuser.HeadPic;
			UserRole = objuser.UserRole;
			UserRoleName = objuser.UserRoleName;
			userbs = objuser.userbs;
			PowerProperty = objuser.PowerProperty;
			telStats = objuser.telStats;

            MasterName = plus.storage.getItem("MasterName");
            UserPower = plus.storage.getItem("UserPower");
            UserPowerName = plus.storage.getItem("UserPowerName");



			//ShowBody(UserName,NickName,HeadPic,UserRole,UserRoleName,userbs,UserPower,UserPowerName,PowerProperty,MasterName);

			plus.key.removeEventListener("backbutton", onback);

		}

		function isPlusReady() {

			if(window.plus && plus.networkinfo.getCurrentType() == plus.networkinfo.CONNECTION_WIFI) {
				plusReady();
			} else {
				document.addEventListener('plusready', plusReady, false);
			}

		}

		function onback() {
			return;
		}

		muiInit();
		isPlusReady();



			var vum = new Vue({
				el: '#bodyinfo',
				data: function() {
					return {
						UserName: "",
						NickName: "",
						HeadPic: "",
						UserPoint: 0,
						UserAmount: 0,
						UserPV: 0,
						UserRoleName: "",
						UserRole: "",
						userbs: "",
						UserPower: "",
						UserPowerName: "",
						PowerProperty: "",
						LevelName: '',
						CardPowerActive: 0,
						MasterName: "",
						RoleNameArr: [],
						MemberList: [],
						MasterList: [],
						IsShowA: 0,
						IsShowB: 0,
						IsShowC: 0,
						IsShowD: 0

					}
				},

				mounted: function() {

					this.$nextTick(function() {

        	              that=this;
        	              setTimeout(function () {
                          that.UserName=UserName;
                          that.NickName=NickName;
                          that.HeadPic=HeadPic;
                          that.UserRoleName=UserRoleName;
                          that.UserRole=UserRole;
                          that.userbs=userbs;
                          that.UserPower=UserPower;
                          that.UserPowerName=UserPowerName;
                          that.PowerProperty=PowerProperty;
                          that.MasterName=MasterName;
                          
                          that.getUserHead();
                          that.UserRoleInfo();
                          that.PowerMenuShow();
                          that.PowerMenuShow();
                          that.getUserAccount(UserName);
                          }, 800);

						
						
					

					})

				},

				methods: {

					getUserHead: function() {
						var myHead = this.HeadPic;

						if(myHead == '' || myHead == null) {
							this.HeadPic = '../img/_icon_self.png';
						} else if(myHead.substr(myHead.length - 1, 1) == '0') {
							this.HeadPic = '../img/_icon_self.png';
						}

					},

					UserRoleInfo: function() {
						var roleArr = UserRoleName.split(',');
						var powerArr = UserRole.split(',');
						this.RoleNameArr = [];
						for(var i = 0; i < roleArr.length; i++) {
							if(roleArr[i] != '会员') {
								this.RoleNameArr.push({
									number: (i + 1),
									RolePower: powerArr[i],
									RoleName: roleArr[i]
								});
							}
						}

						if(this.userbs == '6') {
							this.LevelName = '金牌合伙人';
						}
						if(this.userbs == '7') {
							this.LevelName = '钻石合伙人';
						}

					},

					ExUserPower: function(UserPower, UserPowerName) {

						this.UserPower = UserPower;
						this.UserPowerName = UserPowerName;
						localStorage.setItem('UserPower', UserPower);
						localStorage.setItem('UserPowerName', UserPowerName);
						this.PowerMenuShow();

					},

					PowerMenuShow: function() {

						this.IsShowA = 0;
						this.IsShowB = 0;
						this.IsShowC = 0;
						this.IsShowD = 0;

						if(this.userbs == '6' || this.userbs == '7' || this.UserPower >= 1) {
							this.IsShowA = 1;
						}

						if(this.UserPower == 2 || this.UserPower == 3 || this.UserPower == 8 || this.UserPower == 9 || this.UserPower == 10) {
							this.IsShowB = 1;
						}

						if(this.UserPower == 1 || this.UserPower == 4) {
							this.IsShowC = 1;
						}

						if(this.UserPower == 2 || this.UserPower == 3 || this.UserPower == 9 || this.UserPower == 10) {
							this.IsShowD = 1;
						}

					},

					getUserAccount: function(UserName) {
						var that = this;
						$.ajax({
							url: mallDomainUrl + "api/Member/getUserAccount",
							type: 'get',
							dataType: "json",
							data: {
								UserName: UserName
							},
							beforeSend: function() {
								hui.loading('数据加载中');
							},
							success: function(data) {
								if(data.code == '200') {
									that.UserPoint = data.reward_point;
									that.UserAmount = data.amount;
									that.CardPowerActive = data.cardPower;
									plus.storage.setItem('CardPowerActive', data.cardPower);
								}
							},
							error: function() {
								hui.closeLoading();
								hui.toast("网络错误，请稍后再试");
							},
							complete: function(data, textStatus) {
								hui.closeLoading();
							}
						})

					},

					PowerCardActive: function(goid) {
						if(this.CardPowerActive == 0) {

							hui.confirm('您没有权限,需要激活服务卡？', ['取消', '确定'], function() {
								clicked('../mall/MyPowerCardCount.html', 'MyPowerCardCount.html', 'slide-in-left', '健康服务卡');
							});

						} else {
							if(goid == 1) {
								clicked('MemberDataIndex.html', 'MemberDataIndex.html', 'slide-in-left', '健康数据');
							}
							if(goid == 2) {
								clicked('UploadCaseFiles.html', 'UploadCaseFiles.html', 'slide-in-left', '病历上传')
							}
							if(goid == 3) {
								clickedNoHead('DeviceList.html', 'DeviceList.html', 'slide-in-left');
							}
							if(goid == 4) {
								clicked('MyReportIndex.html', 'MyReportIndex.html', 'zoom-fade-out', '健康评估报告');
							}
							if(goid == 5) {
								clicked('MyProjectRecord.html', 'MyProjectRecord.html', 'zoom-fade-out', '健康方案');
							}
						}
					},




					goPerson: function() {
						
					},
					
					goOrder: function(tab) {
					var parm = {
						"tab": tab
					}
					clickedParm('../mall/OrderList.html', 'OrderList.html', 'zoom-fade-out', parm,'我的订单列表');
					},

					goPower: function(menux) {
						var headTxt = "";
						switch(menux) {

							case 1:
								headTxt = "客户管理";
								break;
							case 2:
								headTxt = "合伙人管理";
								break;
							case 3:
								headTxt = "店务管理";
								break;
							case 4:
								headTxt = "客户健康管理";
								break;
						}
						var parm = {
							"menux": menux
						}
						clickedParm('PersonMenuX.html', 'PersonMenuX.html', 'slide-in-right', parm, headTxt);
					},

					logout: function() {
						plus.storage.removeItem('user');
						switch ( plus.os.name ) {
							case "Android":
								// Android平台: plus.android.*
								plus.runtime.quit();
								break;
							case "iOS":
								// iOS平台: plus.ios.*
								plus.runtime.restart();
								break;
							default:
								// 其它平台
								plus.runtime.quit();
								break;
						}

					},

				}

			});


	</script>

</html>