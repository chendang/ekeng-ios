<!doctype html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=0" />
<meta name="format-detection" content="telephone=no" />
<link href="../css/Anxious.css" type="text/css" rel="stylesheet"/>
    <style type="text/css">
        body { background: #f08519; }

         [v-cloak]{ display: none; }

    </style>
</head>
<body>


<!--自评结果start-->
<div class="ask-resulte ask-resulte01" id="yresult">
  <ul>
    <img src="../img/8-08.png" alt="" id="mp"/>
    <img src="../img/8-04.png" alt="" id="np"/>
    <img src="../img/8-05.png" alt="" />
  </ul>
</div>

<div class="ask-imgs ask-imgs01" id="usebox">
  <a href="javascript:testagain();">再测一次</a>
  <a href="jascript:void(0)">分享</a>
</div>	

<!--自评结果end-->

</body>
<script src="../js/lib/jquery-2.1.3.min.js" type="text/javascript"></script>
<script src="../js/public.js" type="text/javascript"></script>
<script src="../js/base.js" type="text/javascript"></script>
<script>
function calcHW(){
 var heights = window.screen.height;
 $(".ask-imgs").css("min-height",heights -345);
}
calcHW();
$(window).resize(function() {
  calcHW();
});

$("body").css("background","url(../img/7-15.png) no-repeat 0 55px");
$("body").css("background-size","100% auto");
$("body").css("background-color","#a4bde2");
</script>

<script>
		var domainUrl = GetMvcApiDomain();

var username=null;  
var testNum=null;
function plusReady() { 
HeadShow();		
var objuser=JSON.parse(plus.storage.getItem('user'));
username = objuser.UserName;

var _self = plus.webview.currentWebview();
testNum=_self.testNum;

if(testNum==null || testNum==''){
	plus.webview.currentWebview().close();
}

getGrade(username,testNum);

backIndex();
}

if(window.plus){  
plusReady();  
}else{  
document.addEventListener("plusready",plusReady,false);  
} 




function getGrade(username,testnum){

             $.ajax({
             	url: domainUrl + "api/DepressedTest/getTheGrade",
                type: 'get',
                dataType: "json",
                data: {UserName:username,TestNum:testnum},
                success: function (data) {
                	      if (data.code='200'){
                	      var picOne="m0.png";
                        var picTwo="m0.png"
                	      var x="0";
                	      var y="0";
                	      
                        x = data.grade.substring(0,1);   
                        	picOne="m"+x+".png";
                        
                        if (data.grade.length>1){
                        y = data.grade.substring(1,2);
                          picTwo="m"+y+".png";
                        }else{
                        	$("#np").hide();
                        	picTwo="";
                        }

                	      document.getElementById("mp").src="../img/"+picOne;
                	      document.getElementById("np").src="../img/"+picTwo;
                	      var currentImage="../img/yr1.png";
                	      if (parseInt(data.grade)<5){
                	      currentImage="../img/yr1.png";
                	      }
                	      if (parseInt(data.grade)>=5 && parseInt(data.grade)<=10){
                	      currentImage="../img/yr2.png";
                	      }
                	      if (parseInt(data.grade)>=11 && parseInt(data.grade)<=20){
                	      currentImage="../img/yr3.png";
                	      }
                	      if (parseInt(data.grade)>=21 && parseInt(data.grade)<=30){
                	      currentImage="../img/yr4.png";
                	      }
                	      if (parseInt(data.grade)>=31){
                	      currentImage="../img/jr5.png";
                	      }
                	      document.getElementById("yresult").style.backgroundImage="url("+currentImage+")";
                	      
                        plus.nativeUI.toast("您的答题成功提交！");
                       }else{
                       	plus.nativeUI.toast("提交失败,请稍后再试！");
                       	return false;
                       }
                  },
                error: function () {
                plus.nativeUI.toast("网络错误，请稍后再试");
                 }
            })

  }

function backIndex(){
	plus.key.addEventListener("backbutton",function(){
		clearview();

	});
}

function clearview(){
		plus.webview.currentWebview().close();
		var view1=plus.webview.getWebviewById("DepressedPart1.html");
        if(view1){
        view1.close();
        }
    var view2=plus.webview.getWebviewById("DepressedPart2.html");
        if(view2){
        view2.close();
        }
    var view3=plus.webview.getWebviewById("DepressedPart3.html");
        if(view3){
        view3.close();
        }
    var view4=plus.webview.getWebviewById("DepressedPart4.html");
        if(view4){
        view4.close();
        }
    var view5=plus.webview.getWebviewById("DepressedPart5.html");
        if(view5){
        view5.close();
        }
        
    var view6=plus.webview.getWebviewById("DepressedPart6.html");
        if(view6){
        view6.close();
        }
        
    var view7=plus.webview.getWebviewById("DepressedPart7.html");
        if(view7){
        view7.close();
        }
        
    var view8=plus.webview.getWebviewById("DepressedPart8.html");
        if(view8){
        view8.close();
        } 
        
    var view9=plus.webview.getWebviewById("DepressedPart9.html");
        if(view9){
        view9.close();
        }
        
    var view10=plus.webview.getWebviewById("DepressedPart10.html");
        if(view10){
        view10.close();
        }
        
    var view11=plus.webview.getWebviewById("DepressedPart11.html");
        if(view11){
        view11.close();
        }  
        
    var view12=plus.webview.getWebviewById("DepressedPart12.html");
        if(view12){
        view12.close();
        } 
        
    var view13=plus.webview.getWebviewById("DepressedPart13.html");
        if(view13){
        view13.close();
        } 
        
    var view14=plus.webview.getWebviewById("DepressedPart14.html");
        if(view14){
        view14.close();
        } 
        
    var view15=plus.webview.getWebviewById("DepressedPart15.html");
        if(view15){
        view15.close();
        }
        
    var view16=plus.webview.getWebviewById("DepressedPart16.html");
        if(view16){
        view16.close();
        } 
}

function testagain(){
	
clearview();
        
//clicked('DepressedPart1.html','DepressedPart1.html','slide-in-left','抑郁评测量表');
     
}
</script>



</html>