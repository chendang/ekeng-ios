<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <title>心情管理</title>
   <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    	
    <link rel="stylesheet" href="../css/sm.min.css">


		    <link rel="stylesheet" href="../css/my.css">
		<link rel="stylesheet" href="../css/Monitor.css">
		<link rel="stylesheet" href="../css/calendar.css">




    
        <link rel="stylesheet" href="../css/DataScroll.css">

   <link type="text/css" href="../css/sleepAndMood.css" rel="stylesheet" />
    <link type="text/css" href="../css/style.css" rel="stylesheet" />
    
    <link rel="stylesheet" href="../css/lib/huimin.css">

    <script src="../js/base.js"></script>
    <style type="text/css">
    	 [v-cloak]{ display: none; }
        .myblock {

    height: 18.5rem;
    background-color: #FFFADF;
    
}

.myblock .content-block-title {
    position: relative;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    font-size: 0.8rem;
    text-transform: uppercase;
    line-height: 1.2rem;
    color: #de1919;
    margin-top: 0.5rem;
    margin-bottom: 0rem;
    margin-left: 4.5rem;
}

.myblock .row-block {
    width: 100%;
    height: 5rem;
    margin-top: 20px;
   
}

.myblock .row .col-25 {
    width: 33%;
    text-align: center;
}

.myblock .row .col-33 {
    width: 25%;
    margin-left: 0%;
    text-align: center;
}

.myblock .row .col-25 a {
    color: #e01f1f;
}
.myblock .row .col-25 a h3 {
    display: block;
    font-size: 0.8rem;
    margin-left: -10%;
}

.myblock .row .col-25 a img {
    width: 2.5rem;
    height: 2.5rem;
    margin-left: 25%;
}
    </style>

</head>

<body>




<div>
	            <div>
				<header class="bar bar-nav">
					<a class="left bar-nav-mt1 back" onclick="CloseCurrentView();">
						<img src="../img/5-13.png" alt="">
					</a>
					<h2 class="title color-white">心情记录</h2>
					<a onclick="goList();" class="right bar-nav-mt2 right-more">
						<h4><font color="#FFFFFF">历史</font></h4>
					</a>
				</header>
                </div>
				<div class="content">
					<div class="databg" id="head">
					<div class="databg-showall" v-cloak>
						<div class="databg-showdata" v-cloak>
							{{day}}
						</div>
						<div class="databg-showinfo">
							<p class="databg-showinfo-week" v-cloak>{{curweekday}}</p>
							<p class="databg-showinfo-yearmonth" v-cloak>{{year}}年{{month}}月</p>
							<span class="databg-showinfo-text" v-cloak>
                            {{recordStatus}}
                        </span>
						</div>
					</div>
				</div>



    <div style="margin-top: 5px;">
    	

            <!--<div class="left">
                <div class="left_color">
                </div>
                <h4>&nbsp;&nbsp;今天心情趋势</h4>
            </div>-->
            <!--<div class="right">
                <div class="right_color">
                </div>
                <h4>&nbsp;&nbsp;<a href="#">看历史心情</a></h4>
            </div>-->
 </div>
            <div class="mychart">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div id="echarts" style="height: 200px;">
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div id="chart2">
                            </div>
                        </div>
                    </div>
                    <div class="swiper-pagination">
                        &nbsp;</div>
                </div>
            </div>

            <div class="myblock" style="margin-top:5px;padding: 2px;">
                <div class="content-block-title"><p>点击图标选择您此刻心情</p></div>
                <div class="row row-block" style="margin-top:25px;padding: 5px;text-align: center;">
                    <div class="col-25">
                        <a href="#" id="f1">
                            <img src="../img/face1.png" alt="">
                            <h3>开心</h3>
                        </a>
                    </div>
                    <div class="col-25">
                        <a href="#" id="f2">
                            <img src="../img/face2.png" alt="">
                            <h3>舒畅</h3>
                        </a>
                    </div>
                    <div class="col-25">
                        <a href="#" id="f3">
                            <img src="../img/face3.png" alt="">
                            <h3>平静</h3>
                        </a>
                    </div>

                </div>
                
                <div class="row row-block" style="margin-top:5px;padding: 2px;">
                    <div class="col-25">
                        <a href="#" id="f4">
                            <img src="../img/face4.png" alt="">
                            <h3>一般</h3>
                        </a>
                    </div>
                    <div class="col-25">
                        <a href="#" id="f5">
                            <img src="../img/face5.png" alt="">
                            <h3>不爽</h3>
                        </a>
                    </div>
                    <div class="col-25">
                        <a href="#" id="f6">
                            <img src="../img/face6.png" alt="">
                            <h3>焦虑</h3>
                        </a>
                    </div>
                </div>
                
                  <div class="row row-block" style="margin-top:5px;padding: 2px;">
                    <div class="col-25">
                        <a href="#" id="f7">
                            <img src="../img/face7.png" alt="">
                            <h3>厌烦</h3>
                        </a>
                    </div>
                    <div class="col-25">
                        <a href="#" id="f8">
                            <img src="../img/face8.png" alt="">
                            <h3>伤心</h3>
                        </a>
                    </div>
                    <div class="col-25">
                        <a href="#" id="f9">
                            <img src="../img/face9.png" alt="">
                            <h3>生气</h3>
                        </a>
                    </div>
                </div>
            </div>

            <!--<div class="row row-btn1" id="menuon" style="margin-top:45px;padding: 2px;">
                <div class="col-33 btn-col-33">
                    <p><a href="#" class="button mybutton">玩小游戏</a></p>
                </div>
                <div class="col-33 btn-col-33">
                    <p><a href="#" class="button mybutton">心理咨询</a></p>
                </div>
                <div class="col-33 btn-col-33">
                    <p><a href="NewsMore.html?cid=19" class="button mybutton">心理健康知识</a></p>
                </div>
            </div>-->





</div>
         


</body>
<!--底部end-->   

<script src="../js/lib/jquery-2.1.3.min.js" type="text/javascript"></script>
<script src="../js/EchartScroll.min.js"></script>
<script src="../js/iscroll.js"></script>
<script src="../js/FeelQueryScroll.js"></script>
<script src="../js/lib/hui.js"></script>
<script src="../js/public.js" type="text/javascript"></script>
<script src="../js/lib/vue20.min.js" type="text/javascript"></script>
<script src="../js/lib/axios.min.js"></script>
<script src="../js/lib/qs.js"></script>

<script>





var domainUrl = GetMvcApiDomain();
		var username = null;

			
		function plusReady() {

			var objuser = JSON.parse(plus.storage.getItem('user'));
			username = objuser.UserName;
			
			

			
			back();
		}

		if(window.plus) {
			plusReady();
		} else {
			document.addEventListener("plusready", plusReady, false);
		}
		



		var vum = new Vue({
			el: '#head',
			data: function() {
				return {
					UserName: username,
						year: '2018',
						month: "09",
						day: '01',
						curDate: "20180901",
						curweekday: '星期一',
						recordStatus: '未记录'
    	            
				

				}
			},

			created: function() {
             
			},
			mounted: function() {

				this.$nextTick(function() {
					var that=this;
					setTimeout(function() {
                   that.GetData();
                   }, 300);
                   that.getToDayDate();
                   that.GetIsDayRecord(username);
				})

			},

			methods: {
				
					getToDayDate: function() {
						var now = new Date();
						this.year = now.getFullYear(); //年
						this.month = now.getMonth() + 1; //月
						this.day = now.getDate(); //日

						if(this.month < 10)
							this.month = "0" + this.month;

						if(this.day < 10)
							this.day = "0" + this.day;

						this.curDate = this.year.toString() + this.month.toString() + this.day.toString()

						var myddy = now.getDay(); //获取存储当前日期
						var weekday = ["星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六"];
						this.curweekday = weekday[myddy];
					},				
			GetData:function(){
                $.ajax({

             	url: domainUrl + "api/Feeling/getFeelingForToday",
                type: 'get',
                dataType: "json",
                data: {UserName:username},
                success: function (data) {
                
                var jsonx = eval(data.Data);
                
                if(jsonx.length==0){
                  jsonx=[{"code":"200","systime":"2018/10/04 14:52:02","list":[{'feelCode':'0','value':'0','date':'00:00'},]}];
                 showChartData(jsonx[0],'心情指数',0,60,'bar');
                hui.toast("没有今天的数据哦");	
                }else{
                


                showChartData(jsonx[0],'心情指数',0,60,'bar');
               }
  
               },
                error: function () {
                hui.toast("网络错误，请稍后再试");
                }
            
                 })
                     
                },
                
                
             postSaveFelling:function(username,starPoint,starLevel){
             	var that=this;
             var jsonData = {
            "UserName":username,
            "feelCode":starLevel,
            "feelStar":starPoint
            
           }

             $.ajax({
             	url: domainUrl + "api/Feeling/MDaysFeelingAdd",
                type: 'post',
                dataType: "json",
                data:jsonData,
                success: function (data) {
                        if(data.code=="200"){
                        	hui.toast("心情保存成功！");
                        	that.recordStatus = '已记录';
                        	that.GetData();
                        }else{
                        	hui.toast("数据提交发生错误，请稍后再试!");
                        }
                        

                  },
                error: function () {
                hui.toast("网络错误，请稍后再试");
                 }
            })
             },
             
           GetIsDayRecord: function(UserName) {
					var that = this;

					that.axiosGetLoadding();
					axios.get(domainUrl + 'api/Feeling/GetTodayIsRecord', {
							params: {
								UserName: UserName
							}
						})
						.then(function(response) {
							if(response.data.IsRecord >= 1) {
								that.recordStatus = '已记录';
							}
							else{
								that.recordStatus = '未记录';
							}

						})
						.catch(function(response) {
							console.log(response);

						});

				},
             
                
				axiosGetLoadding: function() {
					axios.interceptors.request.use(function(config) {
						console.log('开始请求')
						config.headers['Content-Type'] = 'application/x-www-form-urlencoded';
						hui.loading('数据加载中');
						return config
					}, function(error) {
						console.log('请求失败')
						hui.closeLoading();
						hui.toast("数据加载失败,请检查网络");
						return Promise.reject(error)
					})
					axios.interceptors.response.use(function(config) {
						hui.closeLoading();

						console.log('接收响应')
						return config
					}, function(error) {
						console.log('响应出错')
						hui.closeLoading();
						hui.toast("数据加载失败,请检查网络");
						return Promise.reject(error)
					})
				},

				


			}

		});






 
   
    


    
    


//个人信息列表点击事件
 $('.myblock').on('click', 'a', function() {
var chkid = $(this).attr("id");
var starLevel=0;
var starPoint=0;
if(chkid=="f1"){
starLevel=9;
starPoint=60;
}
if(chkid=="f2"){
starLevel=8;
starPoint=55;
}
if(chkid=="f3"){
starLevel=7;
starPoint=50;
}
if(chkid=="f4"){
starLevel=6;
starPoint=45;
}

if(chkid=="f5"){
starLevel=5;
starPoint=40;
}

if(chkid=="f6"){
starLevel=4;
starPoint=35;
}

if(chkid=="f7"){
starLevel=3;
starPoint=30;
}

if(chkid=="f8"){
starLevel=2;
starPoint=25;
}

if(chkid=="f9"){
starLevel=1;
starPoint=20;
}

vum.postSaveFelling(username,starPoint,starLevel);


});





        function goList(){
              clicked('FeelingList.html', 'FeelingList.html', 'slide-in-left', '我的心情记录');

            }


</script>

</html>
